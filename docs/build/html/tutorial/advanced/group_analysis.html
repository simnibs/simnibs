
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Group Analysis &#8212; SimNIBS 3.0b5 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Uncertainty Quantification" href="uq.html" />
    <link rel="prev" title="Advanced Features" href="advanced.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="advanced.html" title="Previous document">Advanced Features</a>
        </li>
        <li>
          <a href="uq.html" title="Next document">Uncertainty Quantification</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <div class="section" id="group-analysis">
<span id="group-tutorial"></span><h1>Group Analysis<a class="headerlink" href="#group-analysis" title="Permalink to this headline">¶</a></h1>
<p>SimNIBS supports group analysis of electric fields in both <em>FsAverage</em> and <em>MNI</em> spaces.</p>
<p>In this example, we will simulate the average electric field for a simple tDCS montage
across five subjects using the <em>FsAverage</em> space</p>
<div class="section" id="example-dataset">
<h2>Example Dataset<a class="headerlink" href="#example-dataset" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://osf.io/egshq/download">Click here to download the example dataset for group analysis</a>.</p>
<p>This example dataset is composed of a subgroup of a cohort available at <a class="reference external" href="https://openneuro.org/datasets/ds000171">OpenfMRI</a>. The data was processed in SimNIBS 2.1 using <a class="reference internal" href="../../documentation/command_line/headreco.html#headreco-docs"><span class="std std-ref">headreco</span></a>. For more information, please see the <a class="reference external" href="https://osf.io/ah5eu/">OSF repository</a> and <a class="reference external" href="https://doi.org/10.1101/500314">Saturnino et al., 2018</a>.</p>
<p>In this example, we have five subjects, named <code class="file docutils literal notranslate"><span class="pre">sub01</span></code>, <code class="file docutils literal notranslate"><span class="pre">sub09</span></code>,
<code class="file docutils literal notranslate"><span class="pre">sub10</span></code>, <code class="file docutils literal notranslate"><span class="pre">sub12</span></code>, and <code class="file docutils literal notranslate"><span class="pre">sub15</span></code>.</p>
</div>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>Supposed we applied tDCS on the five subjects using an anode over C3 and a cathode over AF4.
We want to obtain the mean and standard deviation of the normal component of the electric field (that the incoming or outgoing electric field component) across all subjects, in all positions of the <em>FsAverage</em> template.</p>
</div>
<div class="section" id="set-up-and-run-simulations">
<h2>Set up and Run Simulations<a class="headerlink" href="#set-up-and-run-simulations" title="Permalink to this headline">¶</a></h2>
<p>There are several ways to set-up and run Simulations in SimNIBS</p>
<div class="section" id="gui">
<h3>GUI<a class="headerlink" href="#gui" title="Permalink to this headline">¶</a></h3>
<p>Set-up the simulation for each subject in the <a class="reference internal" href="../gui.html#gui-tutorial"><span class="std std-ref">Graphical User Interface</span></a>. In this case, remember to tick the <em>Transform to FsAverage</em> option in the <a class="reference internal" href="../../documentation/gui.html#sim-opt"><span class="std std-ref">Simulation Options Window</span></a>. (under <em>Edit</em> -&gt; <em>Simulation Options</em>)</p>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Write a <em>Python</em> script. In this case, remember to set <em>map_to_fsavg</em> to <em>True</em> in the <a class="reference internal" href="../../documentation/sim_struct/session.html#session-doc"><span class="std std-ref">SESSION</span></a> structure. See <a class="reference internal" href="../scripting.html#scripting-tutorial"><span class="std std-ref">Scripting Simulations</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This example runs tDCS simulations with a bipolar montage for five subjects</span>
<span class="sd">    The dataset with the five head models is avaliable at https://osf.io/ah5eu/</span>
<span class="sd">    please look at the &quot;group_average&quot; for how to do a simple analysis of the group data</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">simnibs</span> <span class="kn">import</span> <span class="n">sim_struct</span><span class="p">,</span> <span class="n">run_simnibs</span>

<span class="c1"># Set the subjects</span>
<span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sub01&#39;</span><span class="p">,</span> <span class="s1">&#39;sub09&#39;</span><span class="p">,</span> <span class="s1">&#39;sub10&#39;</span><span class="p">,</span> <span class="s1">&#39;sub12&#39;</span><span class="p">,</span> <span class="s1">&#39;sub15&#39;</span><span class="p">]</span>

<span class="c1"># Set a TDCSLIST structure with the simulation set-up</span>
<span class="n">tdcslist</span> <span class="o">=</span> <span class="n">sim_struct</span><span class="o">.</span><span class="n">TDCSLIST</span><span class="p">()</span>
<span class="n">tdcslist</span><span class="o">.</span><span class="n">currents</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">]</span>

<span class="n">anode</span> <span class="o">=</span> <span class="n">tdcslist</span><span class="o">.</span><span class="n">add_electrode</span><span class="p">()</span>
<span class="n">anode</span><span class="o">.</span><span class="n">channelnr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">anode</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="s1">&#39;C3&#39;</span>
<span class="n">anode</span><span class="o">.</span><span class="n">pos_ydir</span> <span class="o">=</span> <span class="s1">&#39;C1&#39;</span>
<span class="n">anode</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="s1">&#39;rect&#39;</span>
<span class="n">anode</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
<span class="n">anode</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="mi">4</span>


<span class="n">cathode</span> <span class="o">=</span> <span class="n">tdcslist</span><span class="o">.</span><span class="n">add_electrode</span><span class="p">()</span>
<span class="n">cathode</span><span class="o">.</span><span class="n">channelnr</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">cathode</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="s1">&#39;AF4&#39;</span>
<span class="n">cathode</span><span class="o">.</span><span class="n">pos_ydir</span> <span class="o">=</span> <span class="s1">&#39;F6&#39;</span>
<span class="n">cathode</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="s1">&#39;rect&#39;</span>
<span class="n">cathode</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>
<span class="n">cathode</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="mi">4</span>


<span class="c1"># Run the simulation in each subject</span>
<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
    <span class="c1"># ALWAYS create a new SESSION when changing subjects</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">sim_struct</span><span class="o">.</span><span class="n">SESSION</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">map_to_fsavg</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">s</span><span class="o">.</span><span class="n">fnamehead</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">sub</span> <span class="o">+</span> <span class="s1">&#39;.msh&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">pathfem</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="s1">&#39;bipolar&#39;</span><span class="p">)</span>
    <span class="c1"># Don&#39;t open in gmsh</span>
    <span class="n">s</span><span class="o">.</span><span class="n">open_in_gmsh</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c1"># Add the tdcslist we defined above</span>
    <span class="n">s</span><span class="o">.</span><span class="n">add_poslist</span><span class="p">(</span><span class="n">tdcslist</span><span class="p">)</span>
    <span class="c1"># Run the sumulation</span>
    <span class="n">run_simnibs</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="matlab">
<h3>MATLAB<a class="headerlink" href="#matlab" title="Permalink to this headline">¶</a></h3>
<p>Write a <em>MATLAB</em> script. In this case, remember to set <em>map_to_fsavg</em> to <em>True</em> in the <a class="reference internal" href="../../documentation/sim_struct/session.html#session-doc"><span class="std std-ref">SESSION</span></a> structure. See <a class="reference internal" href="../scripting.html#scripting-tutorial"><span class="std std-ref">Scripting Simulations</span></a> for more information.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%  This example runs tDCS simulations with a bipolar montage for five subjects</span>
<span class="c">%  The dataset with the five head models is avaliable at https://osf.io/ah5eu/</span>
<span class="c">%  please look at the &quot;group_average&quot; for how to do a simple analysis of the group data</span>

<span class="c">% Set the subjects</span>
<span class="n">subjects</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;sub01&#39;</span><span class="p">,</span> <span class="s">&#39;sub09&#39;</span><span class="p">,</span> <span class="s">&#39;sub10&#39;</span><span class="p">,</span> <span class="s">&#39;sub12&#39;</span><span class="p">,</span> <span class="s">&#39;sub15&#39;</span><span class="p">};</span>

<span class="c">% Start a SESSION</span>
<span class="n">S</span> <span class="p">=</span> <span class="n">sim_struct</span><span class="p">(</span><span class="s">&#39;SESSION&#39;</span><span class="p">);</span>
<span class="n">S</span><span class="p">.</span><span class="n">map_to_fsavg</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">open_in_gmsh</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>

<span class="c">% Set a TDCSLIST with the simulation set-up</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">sim_struct</span><span class="p">(</span><span class="s">&#39;TDCSLIST&#39;</span><span class="p">);</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">currents</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">];</span>

<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">channelnr</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">centre</span> <span class="p">=</span> <span class="s">&#39;C3&#39;</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">pos_ydir</span> <span class="p">=</span> <span class="s">&#39;C1&#39;</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">shape</span> <span class="p">=</span> <span class="s">&#39;rect&#39;</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">dimensions</span> <span class="p">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">];</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">thickness</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">channelnr</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">centre</span> <span class="p">=</span> <span class="s">&#39;AF4&#39;</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">pos_ydir</span> <span class="p">=</span> <span class="s">&#39;F6&#39;</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">shape</span> <span class="p">=</span> <span class="s">&#39;rect&#39;</span><span class="p">;</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">dimensions</span> <span class="p">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">];</span>
<span class="n">S</span><span class="p">.</span><span class="n">poslist</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">electrode</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">thickness</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="c">% Run the simulation in each subject</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">subjects</span><span class="p">)</span>
     <span class="n">sub</span> <span class="p">=</span> <span class="n">subjects</span><span class="p">{</span><span class="nb">i</span><span class="p">};</span>
     <span class="n">S</span><span class="p">.</span><span class="n">fnamehead</span> <span class="p">=</span> <span class="n">fullfile</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span> <span class="s">&#39;.msh&#39;</span><span class="p">]);</span>  <span class="c">% head mesh</span>
     <span class="n">S</span><span class="p">.</span><span class="n">pathfem</span> <span class="p">=</span> <span class="n">fullfile</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="s">&#39;bipolar&#39;</span><span class="p">);</span> <span class="c">% Output directory</span>
     <span class="n">run_simnibs</span><span class="p">(</span><span class="n">S</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="calculate-statistics">
<h2>Calculate Statistics<a class="headerlink" href="#calculate-statistics" title="Permalink to this headline">¶</a></h2>
<p>When the simulations are over, we need to collect their results to calculate an average. In SimNIBS, we can do it either in Python or MATLAB.
Please notice that, while for setting up simulations Python and MATLAB share a similar interface, in post-processing the interfaces can be very different.</p>
<div class="section" id="id1">
<h3>Python<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This example wil go throgh simulations and calculate</span>
<span class="sd">    the average and the standard deviation of the normal component</span>
<span class="sd">    of the electric field in FsAverage space</span>

<span class="sd">    It is a follow-up to the &quot;run_simulations&quot; example</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">simnibs</span>

<span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sub01&#39;</span><span class="p">,</span> <span class="s1">&#39;sub09&#39;</span><span class="p">,</span> <span class="s1">&#39;sub10&#39;</span><span class="p">,</span> <span class="s1">&#39;sub12&#39;</span><span class="p">,</span> <span class="s1">&#39;sub15&#39;</span><span class="p">]</span>
<span class="n">results_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;bipolar&#39;</span><span class="p">,</span> <span class="s1">&#39;fsavg_overlays&#39;</span><span class="p">)</span>

<span class="c1"># Go though each subject and extract E_normal</span>
<span class="n">normals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
    <span class="c1">## read the msh file</span>
    <span class="n">results_fsavg</span> <span class="o">=</span> <span class="n">simnibs</span><span class="o">.</span><span class="n">msh</span><span class="o">.</span><span class="n">read_msh</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">sub</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,</span>
            <span class="n">f</span><span class="s1">&#39;{sub}_TDCS_1_scalar_fsavg.msh&#39;</span><span class="p">))</span>
    <span class="c1">## extract the normals</span>
    <span class="n">normals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results_fsavg</span><span class="o">.</span><span class="n">field</span><span class="p">[</span><span class="s1">&#39;E_normal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># Calculate the average and standard deviation</span>
<span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">normals</span><span class="p">)</span>
<span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Visualize Mean and Std</span>
<span class="c1">## cleanup the last model by removing the fields</span>
<span class="n">results_fsavg</span><span class="o">.</span><span class="n">nodedata</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">## add the average and standard deviations as nodal data</span>
<span class="n">results_fsavg</span><span class="o">.</span><span class="n">add_node_field</span><span class="p">(</span><span class="n">avg</span><span class="p">,</span> <span class="s1">&#39;E_normal_avg&#39;</span><span class="p">)</span>
<span class="n">results_fsavg</span><span class="o">.</span><span class="n">add_node_field</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="s1">&#39;E_normal_std&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">results_fsavg</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">visible_fields</span><span class="o">=</span><span class="s1">&#39;E_normal_std&#39;</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">## write out results as a .msh and the .opt file for visualization later</span>
<span class="n">results_fsavg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;average_std.msh&#39;</span><span class="p">)</span>
<span class="n">view</span><span class="o">.</span><span class="n">write_opt</span><span class="p">(</span><span class="s1">&#39;average_std.msh&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>MATLAB<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% This example wil go throgh simulations and calculate</span>
<span class="c">% the average and the standard deviation of the normal component</span>
<span class="c">% of the electric field in FsAverage space</span>
<span class="c">% </span>
<span class="c">% It is a follow-up to the &quot;run_simulations&quot; example</span>

<span class="n">subjects</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;sub01&#39;</span><span class="p">,</span> <span class="s">&#39;sub09&#39;</span><span class="p">,</span> <span class="s">&#39;sub10&#39;</span><span class="p">,</span> <span class="s">&#39;sub12&#39;</span><span class="p">,</span> <span class="s">&#39;sub15&#39;</span><span class="p">};</span>
<span class="n">results_folder</span> <span class="p">=</span> <span class="n">fullfile</span><span class="p">(</span><span class="s">&#39;bipolar&#39;</span><span class="p">,</span> <span class="s">&#39;fsavg_overlays&#39;</span><span class="p">);</span>

<span class="n">normals</span> <span class="p">=</span> <span class="p">{};</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">subjects</span><span class="p">)</span>
    <span class="n">sub</span> <span class="p">=</span> <span class="n">subjects</span><span class="p">{</span><span class="nb">i</span><span class="p">};</span>
    <span class="c">% Load normal field data</span>
    <span class="n">m</span> <span class="p">=</span> <span class="n">mesh_load_gmsh4</span><span class="p">(</span><span class="n">fullfile</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span> <span class="s">&#39;_TDCS_1_scalar_fsavg.msh&#39;</span><span class="p">]));</span>
    <span class="c">% Add to cell</span>
    <span class="n">normals</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">m</span><span class="p">.</span><span class="n">node_data</span><span class="p">{</span><span class="n">get_field_idx</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;E_normal&#39;</span><span class="p">,</span> <span class="s">&#39;node&#39;</span><span class="p">)}.</span><span class="n">data</span><span class="p">;</span>
<span class="k">end</span>
<span class="c">% Calculate average and standard deviation of the normal at each node</span>
<span class="n">normals</span> <span class="p">=</span> <span class="n">cell2mat</span><span class="p">(</span><span class="n">normals</span><span class="p">);</span>
<span class="n">avg_normal</span> <span class="p">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">std_normal</span> <span class="p">=</span> <span class="n">std</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="c">% Place the fields in the mesh structure</span>
<span class="n">m</span><span class="p">.</span><span class="n">node_data</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">data</span> <span class="p">=</span> <span class="n">avg_normal</span><span class="p">;</span>
<span class="n">m</span><span class="p">.</span><span class="n">node_data</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;E_normal_avg&#39;</span><span class="p">;</span>
<span class="n">m</span><span class="p">.</span><span class="n">node_data</span><span class="p">{</span><span class="mi">2</span><span class="p">}.</span><span class="n">data</span> <span class="p">=</span> <span class="n">std_normal</span><span class="p">;</span>
<span class="n">m</span><span class="p">.</span><span class="n">node_data</span><span class="p">{</span><span class="mi">2</span><span class="p">}.</span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;E_normal_std&#39;</span><span class="p">;</span>
<span class="c">% Plot the fields</span>
<span class="n">mesh_show_surface</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;field_idx&#39;</span><span class="p">,</span> <span class="s">&#39;E_normal_avg&#39;</span><span class="p">)</span>
<span class="n">mesh_show_surface</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&#39;field_idx&#39;</span><span class="p">,</span> <span class="s">&#39;E_normal_std&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>For more information on group analysis, please see our <a class="reference external" href="https://doi.org/10.1101/500314">SimNIBS 2.1 tutorial paper</a> and <a class="reference external" href="https://doi.org/10.1093/cercor/bhw292A">Bungert et al. 2017</a>.</p>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="advanced.html" title="Previous document">Advanced Features</a>
        </li>
        <li>
          <a href="uq.html" title="Next document">Uncertainty Quantification</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../gui.html">Setting up and Running Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualization.html">Visualizing Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../head_meshing.html">Creating Head Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scripting.html">Scripting Simulations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="advanced.html">Advanced Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../win_prompt.html">Accessing the Command Prompt on Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../tutorial.html">Tutorial</a><ul>
  <li><a href="advanced.html">Advanced Features</a><ul>
      <li>Previous: <a href="advanced.html" title="previous chapter">Advanced Features</a></li>
      <li>Next: <a href="uq.html" title="next chapter">Uncertainty Quantification</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SimNIBS Developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/tutorial/advanced/group_analysis.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>